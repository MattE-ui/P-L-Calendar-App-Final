<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P&L Calendar - Profile setup</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <header class="hero">
    <div class="hero-top">
      <div class="hero-left">
        <h1>P&L Calendar</h1>
        <p class="hero-sub">Trading journal & performance dashboard</p>
      </div>
      <div class="hero-metrics key-metrics">
        <article class="metric-card hero-card" id="hero-portfolio">
          <h3>Portfolio value</h3>
          <div class="metric-value" id="header-portfolio-value">£0.00</div>
          <div class="metric-sub" id="header-portfolio-sub"></div>
        </article>
        <article class="metric-card" id="hero-net-deposits">
          <h3>Net deposits</h3>
          <div class="metric-value" id="hero-net-deposits-value">£0.00</div>
          <div class="metric-sub" id="hero-net-deposits-sub"></div>
        </article>
        <article class="metric-card" id="hero-net-performance">
          <h3>Net performance</h3>
          <div class="metric-value" id="hero-net-performance-value">£0.00</div>
          <div class="metric-sub" id="hero-net-performance-sub"></div>
        </article>
      </div>
      <div class="hero-right">
        <button id="nav-toggle-btn" class="ghost nav-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="nav-drawer">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </header>

  <div id="nav-drawer-overlay" class="nav-overlay hidden" aria-hidden="true"></div>
  <aside id="nav-drawer" class="nav-drawer hidden" aria-label="Primary navigation">
    <div class="nav-drawer-header">
      <h3>Menu</h3>
      <button id="nav-close-btn" class="ghost close-btn" aria-label="Close navigation">✕</button>
    </div>
    <nav class="nav-drawer-actions">
      <button id="quick-settings-btn" class="ghost">Quick Settings</button>
      <button id="calendar-btn" class="ghost">Calendar</button>
      <button id="analytics-btn" class="ghost">Analytics</button>
      <button id="trades-btn" class="ghost">Trades</button>
      <button id="logout-btn" class="danger ghost">Logout</button>
    </nav>
  </aside>

  <main class="container">
    <section class="page-title">
      <h2>Profile</h2>
    </section>
    <div class="profile-container">
      <header class="profile-header">
        <h1>Finish setting up your profile</h1>
        <p class="profile-subtitle">Tell us where your portfolio stands today so we can track performance accurately.</p>
      </header>
      <section class="card profile-card">
      <p class="profile-date" id="profile-date"></p>
      <div class="profile-field">
        <label for="profile-portfolio">Current portfolio value (£)</label>
        <input id="profile-portfolio" type="number" min="0" step="0.01" placeholder="0.00" inputmode="decimal" required>
      </div>
      <div class="profile-field" id="profile-net-total-field">
        <label for="profile-net-deposits">Net deposits to date (£)</label>
        <input id="profile-net-deposits" type="number" step="0.01" placeholder="0.00" inputmode="decimal" required>
        <p class="helper" id="net-deposits-helper-initial">Include lifetime deposits minus withdrawals up to today so we can separate performance from cash movements.</p>
        <p class="helper is-hidden" id="net-deposits-helper-existing">This running total updates automatically when you add or withdraw cash below.</p>
      </div>
      <div class="profile-field is-hidden" id="profile-net-delta-field">
        <label for="profile-net-deposits-delta">Add cash adjustments (£)</label>
        <input id="profile-net-deposits-delta" type="number" step="0.01" placeholder="0.00" inputmode="decimal">
        <p class="helper">Enter additional deposits (positive) or withdrawals (negative) to update your total net deposits.</p>
      </div>
      <div class="profile-actions">
        <button id="profile-save" class="primary">Save and continue</button>
        <button id="profile-logout" class="ghost">Log out</button>
      </div>
      <div id="profile-error" class="error"></div>
    </section>
    <section class="card profile-card security-card">
      <header class="profile-automation-header">
        <h2>Account &amp; security</h2>
        <p class="helper">Update your login details. Password changes take effect immediately.</p>
      </header>
      <div class="profile-field">
        <label for="account-username">Username</label>
        <input id="account-username" type="text" readonly>
      </div>
      <div class="profile-field">
        <label for="account-password-current">Current password</label>
        <input id="account-password-current" type="password" autocomplete="current-password" placeholder="Current password">
      </div>
      <div class="profile-field">
        <label for="account-password-new">New password</label>
        <input id="account-password-new" type="password" placeholder="New password" autocomplete="new-password">
        <p class="helper">Use at least 12 characters, including upper- and lower-case letters, a number, and a symbol.</p>
      </div>
      <div class="profile-actions">
        <button id="account-password-submit" class="ghost">Update password</button>
      </div>
      <div id="account-security-status" class="status-line"></div>
      <div id="account-security-error" class="error"></div>
    </section>
    <section class="card profile-card automation-card">
      <header class="profile-automation-header">
        <h2>Trading 212 automation</h2>
        <p class="helper">Automatically pull your daily portfolio value and cash movements from Trading 212 so your calendar updates itself.</p>
      </header>
      <div class="profile-field toggle-field">
        <label class="toggle">
          <input type="checkbox" id="t212-enabled">
          <span>Enable Trading 212 sync</span>
        </label>
      </div>
      <div id="t212-fields" class="integration-fields">
        <div class="profile-field">
          <label for="t212-api-key">Trading 212 API key</label>
          <input id="t212-api-key" type="password" placeholder="Paste your API key" autocomplete="off">
          <p class="helper">Your key stays on this server and is only used to request the scheduled snapshot.</p>
        </div>
        <div class="profile-field">
          <label for="t212-api-secret">Trading 212 API secret</label>
          <input id="t212-api-secret" type="password" placeholder="Paste your API secret" autocomplete="off">
          <p class="helper">Provide the secret that pairs with your key so we can authenticate with Trading 212.</p>
        </div>
        <div class="profile-field">
          <label for="t212-host">API base URL (optional)</label>
          <input id="t212-host" type="text" placeholder="https://api.trading212.com" autocomplete="off">
          <p class="helper">Trading 212 usually works with <code>https://api.trading212.com</code> (live) or <code>https://demo.trading212.com</code> (practice). Override this only if their docs instruct otherwise.</p>
        </div>
        <div class="profile-field">
          <label for="t212-endpoint">Portfolio endpoint path</label>
          <input id="t212-endpoint" type="text" value="/api/v0/equity/portfolio/summary" autocomplete="off">
          <p class="helper">Keep <code>/api/v0/equity/portfolio/summary</code> unless Trading 212 specifies a different path for your account type.</p>
        </div>
        <div class="profile-field">
          <label for="t212-mode">Account</label>
          <select id="t212-mode">
            <option value="live">Live account</option>
            <option value="practice">Practice (Invest/ISA demo)</option>
          </select>
        </div>
        <div class="profile-field">
          <label for="t212-time">Snapshot time</label>
          <input id="t212-time" type="time" value="21:00" required>
          <p class="helper">Choose the time of day (Europe/London) to capture your portfolio value and net deposits.</p>
        </div>
      </div>
      <section class="integration-instructions">
        <h3>How to set it up</h3>
        <p>This integration records your Trading 212 closing balance at the scheduled time and applies any new deposits or withdrawals to your calendar automatically.</p>
        <ol>
          <li>Open Trading 212 in a browser and generate an API key under <strong>Settings → API</strong>.</li>
          <li>Enable the toggles for <strong>Portfolio value</strong>, <strong>Balance &amp; cash</strong>, and <strong>Transactions</strong> when creating the key. Trading 212 will show you an API key (username) and API secret (password) &mdash; copy both.</li>
          <li>Paste the key and secret above, pick your snapshot time, then save. Update the base URL or endpoint only if Trading 212 provides alternate values.</li>
          <li>Leave your browser or device off &mdash; we will call the API at the chosen time each day and backfill your calendar.</li>
        </ol>
      </section>
      <div class="profile-actions integration-actions">
        <button id="t212-save" class="primary">Save Trading 212 settings</button>
        <button id="t212-run-now" class="ghost">Run sync now</button>
      </div>
      <div id="t212-error" class="error"></div>
      <p id="t212-status" class="status-line"></p>
    </section>
      <section class="card profile-card danger-zone">
      <header class="profile-automation-header">
        <h2>Reset your data</h2>
        <p class="helper">Remove your account, portfolio history, deposits, and integration settings from this server.</p>
      </header>
      <p class="helper">This action permanently deletes your stored data, including anything kept on the persistent disk. You'll need to sign up again to use the app afterwards.</p>
      <div class="profile-actions">
        <button id="profile-reset" class="danger">Delete everything</button>
      </div>
      <div id="profile-reset-error" class="error"></div>
    </section>
    </div>
  </main>
  <div id="quick-settings-modal" class="modal hidden">
    <div class="modal-card">
      <h3>Quick settings</h3>
      <div class="modal-field">
        <label for="qs-risk-select">Default risk per trade</label>
        <select id="qs-risk-select">
          <option value="0.1">0.1%</option>
          <option value="0.25">0.25%</option>
          <option value="0.5">0.5%</option>
          <option value="1">1%</option>
          <option value="2">2%</option>
        </select>
      </div>
      <div class="modal-field">
        <label for="qs-currency-select">Default currency</label>
        <select id="qs-currency-select">
          <option value="GBP">GBP (£)</option>
          <option value="USD">USD ($)</option>
        </select>
      </div>
      <div class="row">
        <button id="save-qs-btn" class="primary">Save</button>
        <button id="close-qs-btn" class="ghost">Close</button>
      </div>
    </div>
  </div>
  <script src="static/profile.js"></script>
</body>
</html>
